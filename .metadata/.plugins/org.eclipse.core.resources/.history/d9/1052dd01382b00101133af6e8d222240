package views;

import clases_partida.Nacion;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.geometry.Pos;
import javafx.geometry.Rectangle2D;
import javafx.scene.control.Label;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.util.Duration;

public class DesktopNacionView {

    private static final Rectangle2D VISTA_ARCHIPIELAGO = new Rectangle2D(0, 190, 400, 250);
    private static final Rectangle2D VISTA_CUNA_KARKOS = new Rectangle2D(84, 52, 400, 250);
    private static final Rectangle2D VISTA_DORNAN = new Rectangle2D(300, 500, 800, 500);
    private static final Rectangle2D VISTA_IMPERIO = new Rectangle2D(1150, 614, 800, 500);
    private static final Rectangle2D VISTA_NORDAST = new Rectangle2D(518, 0, 1024, 640);
    private static final Rectangle2D VISTA_INNON = new Rectangle2D(748, 566, 500, 312);
    private static final Rectangle2D VISTA_THURIMGARD = new Rectangle2D(918, 736, 500, 312);
    private static final Rectangle2D VISTA_ISLAS = new Rectangle2D(1272, 1082, 700, 437);
    private static final Rectangle2D VISTA_ONCACIA = new Rectangle2D(0, 586, 1024, 640);
    

    private ImageView imageView;

    public StackPane crearView(Nacion nacion) {
        StackPane root = new StackPane();

        Label titulo = new Label("üåç Vista del Mundo - " + nacion.getNombre());
        StackPane.setAlignment(titulo, Pos.TOP_CENTER);

        Image imagen = new Image(getClass().getResourceAsStream("/images/Gartea_Ciudades.png"));
        imageView = new ImageView(imagen);
        imageView.setPreserveRatio(true);
        imageView.setSmooth(true);
        imageView.setCache(true);
        imageView.fitWidthProperty().bind(root.widthProperty());
        imageView.fitHeightProperty().bind(root.heightProperty());

        Rectangle2D vistaInicial = getVistaParaNacion(nacion.getNombre());
        imageView.setViewport(vistaInicial);

        root.getChildren().addAll(imageView, titulo);
        return root;
    }

    private Rectangle2D getVistaParaNacion(String nombre) {
        switch (nombre) {
            case "Cuna de Karkos": return VISTA_CUNA_KARKOS;
            case "Nordast": return VISTA_NORDAST;
            case "Archipi√©lago Coralino": return VISTA_ARCHIPIELAGO;
            case "Imperio Sirivi": return VISTA_IMPERIO;
            case "Dornan": return VISTA_DORNAN;
            case "Innon": return VISTA_INNON;
            case "Thurimgard": return VISTA_THURIMGARD;
            case "Islas de Mend Hevak": return VISTA_ISLAS;
            case "Oncacia": return VISTA_ONCACIA;
            default: return new Rectangle2D(0, 0, 800, 500);
        }
    }

    public void desplazarAHacia(String nuevaNacion) {
        Rectangle2D destino = getVistaParaNacion(nuevaNacion);
        Rectangle2D actual = imageView.getViewport();

        double startX = actual.getMinX();
        double startY = actual.getMinY();
        double startW = actual.getWidth();
        double startH = actual.getHeight();

        double endX = destino.getMinX();
        double endY = destino.getMinY();
        double endW = destino.getWidth();
        double endH = destino.getHeight();

        int pasos = 100;
        double deltaX = (endX - startX) / pasos;
        double deltaY = (endY - startY) / pasos;
        double deltaW = (endW - startW) / pasos;
        double deltaH = (endH - startH) / pasos;

        Timeline timeline = new Timeline();

        for (int i = 0; i <= pasos; i++) {
            double x = startX + i * deltaX;
            double y = startY + i * deltaY;
            double w = startW + i * deltaW;
            double h = startH + i * deltaH;

            KeyFrame keyFrame = new KeyFrame(
                Duration.millis(i * 15),
                e -> imageView.setViewport(new Rectangle2D(x, y, w, h))
            );

            timeline.getKeyFrames().add(keyFrame);
        }

        timeline.setCycleCount(1);
        timeline.play();
    }
}
