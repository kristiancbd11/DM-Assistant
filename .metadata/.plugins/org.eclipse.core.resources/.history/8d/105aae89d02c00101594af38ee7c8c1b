package designerView;

import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Label;
import javafx.scene.layout.VBox;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class CategoriaPaleta {

    private final String titulo;
    private final List<?> elementos;
    private final Map<Integer, Boolean> estadoColocados = new HashMap<>();
    private final Map<String, Object> objetosPorNombre = new HashMap<>();
    private final VBox contenedor = new VBox(5);

    public CategoriaPaleta(String titulo, List<?> elementos) {
        this.titulo = titulo;
        this.elementos = elementos;
        inicializar();
    }

    private void inicializar() {
        contenedor.setPadding(new Insets(5));
        contenedor.setAlignment(Pos.TOP_CENTER);

        for (Object obj : elementos) {
            String nombre = obj.toString();
            int id = obtenerIdDesdeObjeto(obj);
            objetosPorNombre.put(nombre, obj);
            estadoColocados.put(id, false);

            Label label = new Label(nombre);
            label.setStyle("-fx-background-color: lightblue; -fx-padding: 5px; -fx-border-color: gray;");
            label.setUserData(Map.of("nombre", nombre, "categoria", titulo));

            label.setOnDragDetected(event -> {
                var db = label.startDragAndDrop(javafx.scene.input.TransferMode.MOVE);
                var content = new javafx.scene.input.ClipboardContent();
                content.putString(nombre);
                db.setContent(content);
                db.setDragView(label.snapshot(null, null));
                event.consume();
            });

            contenedor.getChildren().add(label);
        }
    }

    private int obtenerIdDesdeObjeto(Object obj) {
        try {
            var method = obj.getClass().getMethod("getId");
            return (int) method.invoke(obj);
        } catch (Exception e) {
            System.err.println("Error al obtener ID de objeto: " + e.getMessage());
            return -1;
        }
    }

    public VBox getContenedor() {
        return contenedor;
    }

    public String getTitulo() {
        return titulo;
    }

    public Map<Integer, Boolean> getEstadoColocados() {
        return estadoColocados;
    }

    public Map<String, Object> getObjetosPorNombre() {
        return objetosPorNombre;
    }
}
