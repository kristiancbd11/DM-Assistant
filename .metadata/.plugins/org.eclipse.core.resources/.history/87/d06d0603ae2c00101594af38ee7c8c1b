package designerView;

import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Label;
import javafx.scene.control.TitledPane;
import javafx.scene.layout.VBox;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class CategoriaPaleta {

    private final String titulo;
    private final List<?> elementos;
    private final VBox contenedor;
    private final Map<Integer, Boolean> estadoColocacion = new HashMap<>();

    public CategoriaPaleta(String titulo, List<?> elementos) {
        this.titulo = titulo;
        this.elementos = elementos;
        this.contenedor = new VBox(5);
        this.contenedor.setPadding(new Insets(5));
        this.contenedor.setAlignment(Pos.TOP_CENTER);

        construirPaleta();
    }

    private void construirPaleta() {
        for (Object obj : elementos) {
            String nombre = obj.toString();
            int id = obtenerIdDesdeObjeto(obj);
            estadoColocacion.put(id, false);

            Label label = new Label(nombre);
            label.setStyle("-fx-background-color: lightblue; -fx-padding: 5px; -fx-border-color: gray;");
            label.setUserData(Map.of("nombre", nombre, "categoria", titulo, "id", id));

            contenedor.getChildren().add(label);
        }
    }

    private int obtenerIdDesdeObjeto(Object obj) {
        try {
            var method = obj.getClass().getMethod("getId");
            return (int) method.invoke(obj);
        } catch (Exception e) {
            System.err.println("Error obteniendo ID: " + e.getMessage());
            return -1;
        }
    }

    public TitledPane getTitledPane() {
        return new TitledPane(titulo, contenedor);
    }

    public Map<Integer, Boolean> getEstadoColocacion() {
        return estadoColocacion;
    }

    public VBox getContenedor() {
        return contenedor;
    }
}
