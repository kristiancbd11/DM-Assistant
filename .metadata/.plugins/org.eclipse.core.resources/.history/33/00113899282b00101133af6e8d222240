package views;

import clases_partida.Nacion;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.geometry.Pos;
import javafx.geometry.Rectangle2D;
import javafx.scene.control.Label;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.util.Duration;

public class DesktopNacionView {

    private static final Rectangle2D VISTA_CUNA_KARKOS = new Rectangle2D(50, 50, 800, 500);
    private static final Rectangle2D VISTA_NORDAST = new Rectangle2D(300, 0, 800, 500);

    public StackPane crearView(Nacion nacion) {
        StackPane root = new StackPane();

        VBox layout = new VBox(10);
        layout.setAlignment(Pos.CENTER);

        Label titulo = new Label("üåç Vista del Mundo - " + nacion.getNombre());

        Image imagen = new Image(getClass().getResourceAsStream("/images/Gartea_Ciudades.png"));
        ImageView imageView = new ImageView(imagen);
        imageView.setPreserveRatio(true);
        imageView.fitWidthProperty().bind(root.widthProperty());
        imageView.fitHeightProperty().bind(root.heightProperty());

        // Aplicar viewport solo si es "Cuna de Karkos"
        if ("Cuna de Karkos".equals(nacion.getNombre())) {
            imageView.setViewport(VISTA_CUNA_KARKOS);
        } else if ("Nordast".equals(nacion.getNombre())) {
            Timeline timeline = new Timeline();

            for (int i = 0; i < 100; i++) {
                int x = i;
                int y = i;
                KeyFrame keyFrame = new KeyFrame(
                    Duration.millis(i * 50), // cada 50 ms
                    e -> imageView.setViewport(new Rectangle2D(x, y, 800, 500))
                );
                timeline.getKeyFrames().add(keyFrame);
            }

            timeline.setCycleCount(1); // una sola vez
            timeline.play();
        }

        layout.getChildren().addAll(titulo, imageView);
        root.getChildren().add(layout);
        return root;
    }
}
