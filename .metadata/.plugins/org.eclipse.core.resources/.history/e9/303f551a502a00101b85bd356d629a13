package views;

import control.*;
import javafx.application.Application;
import javafx.concurrent.Task;
import javafx.scene.Scene;
import javafx.stage.Stage;

public class MainApp extends Application {

    @Override
    public void start(Stage primaryStage) {
        // Instanciar MainView
        MainView mainView = new MainView();

        // Mostrar LoadingView inicialmente
        LoadingView loadingView = new LoadingView();
        mainView.setCenter(loadingView);

        // Preparar la escena
        Scene scene = new Scene(mainView.getRoot(), 1200, 800);
        primaryStage.setScene(scene);
        primaryStage.setTitle("DM Assistant");
        primaryStage.setMaximized(true);
        primaryStage.show();

        // Ejecutar la tarea de carga de datos en segundo plano
        Task<Void> loadDataTask = new Task<>() {
            @Override
            protected Void call() {
                // Simula la carga de datos (Hibernate)
                simulateHibernateLoading(); 
                return null;
            }
        };

        loadDataTask.setOnSucceeded(e -> {
            // Una vez que la carga ha terminado, instanciamos las vistas
            ToolBarView toolBarView = new ToolBarView();
            ExplorerView explorerView = new ExplorerView();
            DesktopView desktopView = new DesktopView();
            InfoView infoView = new InfoView();
            TaskBarView taskBarView = new TaskBarView();

            // Instanciamos los controladores
            new ToolBarController(toolBarView);
            new ExplorerController(explorerView, infoView, desktopView);
            new DesktopController(desktopView);
            new InfoController(infoView);
            new TaskBarController(taskBarView);

            // Finalmente, actualizamos la vista con las vistas principales
            mainView.showMainContent(toolBarView, explorerView, desktopView, infoView, taskBarView);
        });

        new Thread(loadDataTask).start();
    }

    // Simula una carga de datos de Hibernate (aquí va tu lógica de Hibernate)
    private void simulateHibernateLoading() {
        try {
            Thread.sleep(3000); // Simula carga de 3 segundos
            // Aquí iría la inicialización de Hibernate y carga de datos
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        launch(args);
    }
}
