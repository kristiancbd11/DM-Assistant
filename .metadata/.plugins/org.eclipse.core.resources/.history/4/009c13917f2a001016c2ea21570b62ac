package views;

import control.*;
import javafx.application.Application;
import javafx.concurrent.Task;
import javafx.scene.Scene;
import javafx.stage.Stage;

public class MainApp extends Application {

    @Override
    public void start(Stage primaryStage) {
        // Crear MainView
        MainView mainView = new MainView();

        // Mostrar pantalla de carga mientras se inicializa
        mainView.setCenter(new LoadingView());

        // Configurar escena y ventana
        Scene scene = new Scene(mainView.getRoot(), 1200, 800);
        primaryStage.setScene(scene);
        primaryStage.setTitle("DM Assistant");
        primaryStage.setMaximized(true);
        primaryStage.show();

        // Cargar datos y construir componentes en segundo plano
        Task<Void> loadDataTask = new Task<>() {
            @Override
            protected Void call() {
                simulateHibernateLoading(); // Simula la carga (Hibernate o similar)
                return null;
            }
        };

        loadDataTask.setOnSucceeded(event -> {
            // Crear vistas
            ToolBarView toolBarView = new ToolBarView();
            ExplorerView explorerView = new ExplorerView();
            DesktopView desktopView = new DesktopView();
            InfoView infoView = new InfoView();
            TaskBarView taskBarView = new TaskBarView();

            // Crear controladores
            DesktopController desktopController = new DesktopController(desktopView);
            InfoController infoController = new InfoController(infoView);
            ExplorerController explorerController = new ExplorerController(explorerView, infoView, desktopController);
            ToolBarController toolBarController = new ToolBarController(toolBarView);
            TaskBarController taskBarController = new TaskBarController(taskBarView);

            // Mostrar el contenido principal en la UI
            mainView.showMainContent(toolBarView, explorerView, desktopView, infoView, taskBarView);
        });

        new Thread(loadDataTask).start();
    }

    private void simulateHibernateLoading() {
        try {
            Thread.sleep(3000); // Simula carga de 3 segundos
            // Aquí debería ir tu lógica de carga real de datos (Hibernate, etc.)
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        launch(args);
    }
}
