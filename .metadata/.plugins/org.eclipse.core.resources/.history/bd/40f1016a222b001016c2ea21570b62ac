package views;

import clases_partida.Nacion;
import javafx.geometry.Pos;
import javafx.geometry.Rectangle2D;
import javafx.scene.control.Label;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;

import java.util.HashMap;
import java.util.Map;

public class DesktopNacionView {

    private static final int VENTANA_ANCHO = 400;
    private static final int VENTANA_ALTO = 200;
    private static final int IMAGEN_ANCHO = 2048;
    private static final int IMAGEN_ALTO = 1536;

    private final Map<String, Rectangle2D> coordenadasNaciones = new HashMap<>();

    public DesktopNacionView() {
    	asignarCoordenadasFijas();
    }

    public StackPane crearView(Nacion nacion) {
        StackPane root = new StackPane();

        VBox layout = new VBox(10);
        layout.setAlignment(Pos.CENTER);

        Label titulo = new Label("🌍 Vista del Mundo - " + nacion.getNombre());

        Image imagen = new Image(getClass().getResourceAsStream("/images/Gartea_Ciudades.png"));
        ImageView imageView = new ImageView(imagen);
        imageView.setPreserveRatio(false);

        // Esto asegura que el ImageView se expanda
        imageView.fitWidthProperty().bind(root.widthProperty());
        imageView.fitHeightProperty().bind(root.heightProperty());

        // Ajustar viewport cuando el tamaño del ImageView cambie
        imageView.layoutBoundsProperty().addListener((obs, oldVal, newVal) -> {
            double ancho = newVal.getWidth();
            double alto = newVal.getHeight();

            Rectangle2D coords = coordenadasNaciones.getOrDefault(nacion.getNombre(), new Rectangle2D(0, 0, 200, 200));
            double x = coords.getMinX();
            double y = coords.getMinY();

            // Asegurar que no se salga de los bordes de la imagen
            double width = coords.getWidth();
            double height = coords.getHeight();
            imageView.setViewport(new Rectangle2D(x, y, width, height));

        });

        layout.getChildren().addAll(titulo, imageView);
        root.getChildren().add(layout);
        return root;
    }

    private void asignarCoordenadasFijas() {
    	coordenadasNaciones.put("Nordast", new Rectangle2D(200, 0, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Imperio Sirivi", new Rectangle2D(600, 800, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Oncacia", new Rectangle2D(950, 1200, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Dornan", new Rectangle2D(300, 200, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Thurimgard", new Rectangle2D(300, 1100, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Innon", new Rectangle2D(1700, 1300, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Patria Nagi", new Rectangle2D(100, 400, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Santuario", new Rectangle2D(1450, 900, VENTANA_ANCHO, VENTANA_ALTO));
    	coordenadasNaciones.put("Cuna de Karkos", new Rectangle2D(400, 200, 0, 0));
    	coordenadasNaciones.put("Islas de Mend Hevak", new Rectangle2D(1800, 200, VENTANA_ANCHO, VENTANA_ALTO));
    }

}
